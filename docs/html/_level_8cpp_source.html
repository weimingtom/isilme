<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Isilme SDK: D:/Projects/Isilme Project/Engine/Core/Level.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Isilme SDK
   &#160;<span id="projectnumber">0.3.9.5</span>
   </div>
   <div id="projectbrief">Gamedev framework</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">D:/Projects/Isilme Project/Engine/Core/Level.cpp</div>  </div>
</div>
<div class="contents">
<a href="_level_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 ﻿<span class="comment">//  Copyright (C) 2010-2012 VSTU</span>
<a name="l00002"></a>00002 <span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">//      This file is part of Isilme SDK.</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">//              Isilme SDK is free software: you can redistribute it and/or modify</span>
<a name="l00006"></a>00006 <span class="comment">//              it under the terms of the GNU Lesser General Public License as published by</span>
<a name="l00007"></a>00007 <span class="comment">//              the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00008"></a>00008 <span class="comment">//              (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment">//</span>
<a name="l00010"></a>00010 <span class="comment">//              Isilme SDK is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment">//              but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment">//              MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00013"></a>00013 <span class="comment">//              GNU Lesser General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment">//</span>
<a name="l00015"></a>00015 <span class="comment">//              You should have received a copy of the GNU Lesser General Public License</span>
<a name="l00016"></a>00016 <span class="comment">//              along with Isilme SDK.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00017"></a>00017 <span class="comment">//</span>
<a name="l00018"></a>00018 <span class="comment">//      Этот файл — часть Isilme SDK.</span>
<a name="l00019"></a>00019 <span class="comment">//</span>
<a name="l00020"></a>00020 <span class="comment">//              Isilme SDK - свободная программа: вы можете перераспространять ее и/или</span>
<a name="l00021"></a>00021 <span class="comment">//              изменять ее на условиях Меньшей стандартной общественной лицензии GNU в том виде,</span>
<a name="l00022"></a>00022 <span class="comment">//              в каком она была опубликована Фондом свободного программного обеспечения;</span>
<a name="l00023"></a>00023 <span class="comment">//              либо версии 3 лицензии, либо (по вашему выбору) любой более поздней</span>
<a name="l00024"></a>00024 <span class="comment">//              версии.</span>
<a name="l00025"></a>00025 <span class="comment">//</span>
<a name="l00026"></a>00026 <span class="comment">//              Isilme SDK распространяется в надежде, что она будет полезной,</span>
<a name="l00027"></a>00027 <span class="comment">//              но БЕЗО ВСЯКИХ ГАРАНТИЙ; даже без неявной гарантии ТОВАРНОГО ВИДА</span>
<a name="l00028"></a>00028 <span class="comment">//              или ПРИГОДНОСТИ ДЛЯ ОПРЕДЕЛЕННЫХ ЦЕЛЕЙ. Подробнее см. в Меньшей стандартной</span>
<a name="l00029"></a>00029 <span class="comment">//              общественной лицензии GNU.</span>
<a name="l00030"></a>00030 <span class="comment">//</span>
<a name="l00031"></a>00031 <span class="comment">//              Вы должны были получить копию Меньшей стандартной общественной лицензии GNU</span>
<a name="l00032"></a>00032 <span class="comment">//              вместе с этой программой. Если это не так, см.</span>
<a name="l00033"></a>00033 <span class="comment">//              &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="_isilme_p_c_h_8h.html">IsilmePCH.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="_joints_8h.html">Joints.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="_layer_8h.html">Layer.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="_level_8h.html">Level.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="_entity_8h.html">Entity.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="_query_8h.html">Query.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="_factory_manager_8h.html">FactoryManager.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="_game_8h.html">Game.h</a>&quot;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="namespace_ray_cast.html">00043</a> <span class="keyword">namespace </span>RayCast
<a name="l00044"></a>00044 {
<a name="l00045"></a><a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834ef">00045</a>         <span class="keyword">enum</span> <a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834ef">Mode</a>
<a name="l00046"></a>00046         {
<a name="l00047"></a><a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834efa37b888e946f0973666da6de865653e73">00047</a>                 <a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834efa37b888e946f0973666da6de865653e73">Nearest</a> = 0,
<a name="l00048"></a><a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834efa7afde2c2862a62620c77c16cc076cdd3">00048</a>                 <a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834efa7afde2c2862a62620c77c16cc076cdd3">All</a> = 1,
<a name="l00049"></a><a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834efa1b2e412c6d36b6680eb09ca59563bc57">00049</a>                 <a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834efa1b2e412c6d36b6680eb09ca59563bc57">Any</a> = 2
<a name="l00050"></a>00050         };
<a name="l00051"></a>00051 };
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="class_ray_query_impl.html">00053</a> <span class="keyword">class </span><a class="code" href="class_ray_query_impl.html">RayQueryImpl</a> : <span class="keyword">public</span> <a class="code" href="class_query.html" title="Query result.">Query</a>, <span class="keyword">public</span> b2RayCastCallback
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055 <span class="keyword">public</span>:
<a name="l00056"></a><a class="code" href="class_ray_query_impl_ab05bcccb723d30c094a38355a28c3943.html#ab05bcccb723d30c094a38355a28c3943">00056</a>         <a class="code" href="class_ray_query_impl_ab05bcccb723d30c094a38355a28c3943.html#ab05bcccb723d30c094a38355a28c3943">RayQueryImpl</a>(b2World* world, <span class="keywordtype">float</span> x1, <span class="keywordtype">float</span> y1, <span class="keywordtype">float</span> x2, <span class="keywordtype">float</span> y2, <a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834ef">RayCast::Mode</a> mode = <a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834efa7afde2c2862a62620c77c16cc076cdd3">RayCast::All</a>)
<a name="l00057"></a>00057         {
<a name="l00058"></a>00058                 mWorld = world;
<a name="l00059"></a>00059                 mPoint1.Set(x1, y1);
<a name="l00060"></a>00060                 mPoint2.Set(x2, y2);
<a name="l00061"></a>00061                 mMode = mode;
<a name="l00062"></a>00062         }
<a name="l00063"></a>00063 
<a name="l00064"></a><a class="code" href="class_ray_query_impl_a732ed99b4f3894f67ed22608d28269cd.html#a732ed99b4f3894f67ed22608d28269cd">00064</a>         <span class="keyword">virtual</span> <a class="code" href="class_ray_query_impl_a732ed99b4f3894f67ed22608d28269cd.html#a732ed99b4f3894f67ed22608d28269cd">~RayQueryImpl</a>()
<a name="l00065"></a>00065         {
<a name="l00066"></a>00066         }
<a name="l00067"></a>00067 
<a name="l00068"></a><a class="code" href="class_ray_query_impl_a4eb97c62221bdbda005c7fd606d7d9b8.html#a4eb97c62221bdbda005c7fd606d7d9b8">00068</a>         <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_ray_query_impl_a4eb97c62221bdbda005c7fd606d7d9b8.html#a4eb97c62221bdbda005c7fd606d7d9b8" title="Executes this object.">Execute</a>()
<a name="l00069"></a>00069         {
<a name="l00070"></a>00070                 mWorld-&gt;RayCast(<span class="keyword">this</span>, mPoint1, mPoint2);
<a name="l00071"></a>00071                 <span class="keywordflow">return</span> <a class="code" href="class_query_a06e8444a20d0bb56268ebe83c25706d9.html#a06e8444a20d0bb56268ebe83c25706d9" title="Gets the entities count.">GetEntitiesCount</a>() &gt; 0;
<a name="l00072"></a>00072         }
<a name="l00073"></a>00073 <span class="keyword">protected</span>:
<a name="l00074"></a><a class="code" href="class_ray_query_impl_af8b19231c4d3fbe06a7877aba8783201.html#af8b19231c4d3fbe06a7877aba8783201">00074</a>         <span class="keyword">virtual</span> float32 <a class="code" href="class_ray_query_impl_af8b19231c4d3fbe06a7877aba8783201.html#af8b19231c4d3fbe06a7877aba8783201">ReportFixture</a>(b2Fixture* fixture, <span class="keyword">const</span> <a class="code" href="_definitions_8h_ac41ea418abac18d703df1b41c255ee26.html#ac41ea418abac18d703df1b41c255ee26" title="Определения, относящиеся к Box2D.">Vector2</a>&amp; point, <span class="keyword">const</span> <a class="code" href="_definitions_8h_ac41ea418abac18d703df1b41c255ee26.html#ac41ea418abac18d703df1b41c255ee26" title="Определения, относящиеся к Box2D.">Vector2</a>&amp; normal, float32 fraction)
<a name="l00075"></a>00075         {
<a name="l00076"></a>00076                 <span class="keywordflow">if</span> (mMode == <a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834efa37b888e946f0973666da6de865653e73">RayCast::Nearest</a>)
<a name="l00077"></a>00077                 {
<a name="l00078"></a>00078                         <span class="keywordflow">if</span> (minFraction &gt; fraction || <a class="code" href="class_query_a06e8444a20d0bb56268ebe83c25706d9.html#a06e8444a20d0bb56268ebe83c25706d9" title="Gets the entities count.">GetEntitiesCount</a>() == 0)
<a name="l00079"></a>00079                         {
<a name="l00080"></a>00080                                 minFraction = fraction;
<a name="l00081"></a>00081                                 <a class="code" href="class_entity.html" title="Описывает любую сущность в игре.">Entity</a>* e = (<a class="code" href="class_entity.html" title="Описывает любую сущность в игре.">Entity</a>*)(fixture-&gt;GetBody()-&gt;GetUserData());
<a name="l00082"></a>00082                                 <a class="code" href="_definitions_8h_a126114eb9a0e14f8692cd529993dec94.html#a126114eb9a0e14f8692cd529993dec94">BehaviourPtr</a> b = e-&gt;<a class="code" href="class_entity_a2673c01642bcd692ca0a2ce6d10c81e1.html#a2673c01642bcd692ca0a2ce6d10c81e1" title="Gets the behaviour.">GetBehaviour</a>();
<a name="l00083"></a>00083                                 <a class="code" href="class_query_ad2e168be3faf7cf41da7f0b82b629869.html#ad2e168be3faf7cf41da7f0b82b629869" title="Pushes an entity.">PushEntity</a>(b-&gt;GetActor());
<a name="l00084"></a>00084                         }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086                         <span class="keywordflow">return</span> fraction;
<a name="l00087"></a>00087                 }
<a name="l00088"></a>00088                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mMode == <a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834efa7afde2c2862a62620c77c16cc076cdd3">RayCast::All</a>)
<a name="l00089"></a>00089                 {
<a name="l00090"></a>00090                         <a class="code" href="_definitions_8h_ab0e52c981a1bcd04e292959e2e8e1d84.html#ab0e52c981a1bcd04e292959e2e8e1d84">EntityPtr</a> entity = ((<a class="code" href="class_entity.html" title="Описывает любую сущность в игре.">Entity</a>*)(fixture-&gt;GetBody()-&gt;GetUserData()))-&gt;GetBehaviour()-&gt;GetActor();
<a name="l00091"></a>00091                         <a class="code" href="class_query_ad2e168be3faf7cf41da7f0b82b629869.html#ad2e168be3faf7cf41da7f0b82b629869" title="Pushes an entity.">PushEntity</a>(entity);
<a name="l00092"></a>00092                         <span class="keywordflow">return</span> 1;
<a name="l00093"></a>00093                 }
<a name="l00094"></a>00094                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mMode ==<a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834efa1b2e412c6d36b6680eb09ca59563bc57">RayCast::Any</a>)
<a name="l00095"></a>00095                 {
<a name="l00096"></a>00096                         <a class="code" href="class_query_ad2e168be3faf7cf41da7f0b82b629869.html#ad2e168be3faf7cf41da7f0b82b629869" title="Pushes an entity.">PushEntity</a>((((<a class="code" href="class_entity.html" title="Описывает любую сущность в игре.">Entity</a>*)(fixture-&gt;GetBody()-&gt;GetUserData()))-&gt;GetBehaviour())-&gt;GetActor());
<a name="l00097"></a>00097                         <span class="keywordflow">return</span> 0;
<a name="l00098"></a>00098                 }
<a name="l00099"></a>00099                 <span class="keywordflow">return</span> 1;
<a name="l00100"></a>00100         }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <span class="keyword">private</span>:
<a name="l00103"></a>00103         b2World* mWorld;
<a name="l00104"></a>00104         float32 minFraction;
<a name="l00105"></a>00105         <a class="code" href="_definitions_8h_ac41ea418abac18d703df1b41c255ee26.html#ac41ea418abac18d703df1b41c255ee26" title="Определения, относящиеся к Box2D.">Vector2</a> mPoint1;
<a name="l00106"></a>00106         <a class="code" href="_definitions_8h_ac41ea418abac18d703df1b41c255ee26.html#ac41ea418abac18d703df1b41c255ee26" title="Определения, относящиеся к Box2D.">Vector2</a> mPoint2;
<a name="l00107"></a>00107         <a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834ef">RayCast::Mode</a> mMode;
<a name="l00108"></a>00108 };
<a name="l00109"></a>00109 
<a name="l00110"></a><a class="code" href="class_a_a_b_b_query_impl.html">00110</a> <span class="keyword">class </span><a class="code" href="class_a_a_b_b_query_impl.html">AABBQueryImpl</a> : <span class="keyword">public</span> <a class="code" href="class_query.html" title="Query result.">Query</a>, <span class="keyword">public</span> b2QueryCallback
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112 <span class="keyword">public</span>:
<a name="l00113"></a><a class="code" href="class_a_a_b_b_query_impl_a4a48db18a727b1b7bb469f4ef4d42075.html#a4a48db18a727b1b7bb469f4ef4d42075">00113</a>         <a class="code" href="class_a_a_b_b_query_impl_a4a48db18a727b1b7bb469f4ef4d42075.html#a4a48db18a727b1b7bb469f4ef4d42075">AABBQueryImpl</a>(b2World* world, <span class="keywordtype">float</span> x1, <span class="keywordtype">float</span> y1, <span class="keywordtype">float</span> x2, <span class="keywordtype">float</span> y2)
<a name="l00114"></a>00114         {
<a name="l00115"></a>00115                 mAABB.lowerBound.Set(x1 &lt; x2 ? x1 : x2, y1 &lt; y2 ? y1 : y2);
<a name="l00116"></a>00116                 mAABB.upperBound.Set(x1 &gt; x2 ? x1 : x2, y1 &gt; y2 ? y1 : y2);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118                 mWorld = world;
<a name="l00119"></a>00119         }
<a name="l00120"></a>00120 
<a name="l00121"></a><a class="code" href="class_a_a_b_b_query_impl_a9737124006fba33389a842dfa6bde95f.html#a9737124006fba33389a842dfa6bde95f">00121</a>         <span class="keyword">virtual</span> <a class="code" href="class_a_a_b_b_query_impl_a9737124006fba33389a842dfa6bde95f.html#a9737124006fba33389a842dfa6bde95f">~AABBQueryImpl</a>()
<a name="l00122"></a>00122         {
<a name="l00123"></a>00123         }
<a name="l00124"></a>00124 
<a name="l00125"></a><a class="code" href="class_a_a_b_b_query_impl_a3f4ea3e1567d2c20aaac3c53e1aff279.html#a3f4ea3e1567d2c20aaac3c53e1aff279">00125</a>         <span class="keyword">virtual</span> <span class="keywordtype">bool</span>    <a class="code" href="class_a_a_b_b_query_impl_a3f4ea3e1567d2c20aaac3c53e1aff279.html#a3f4ea3e1567d2c20aaac3c53e1aff279" title="Executes this object.">Execute</a>()
<a name="l00126"></a>00126         {
<a name="l00127"></a>00127                 mWorld-&gt;QueryAABB(<span class="keyword">this</span>, mAABB);
<a name="l00128"></a>00128 
<a name="l00129"></a>00129                 <span class="keywordflow">return</span> <a class="code" href="class_query_a06e8444a20d0bb56268ebe83c25706d9.html#a06e8444a20d0bb56268ebe83c25706d9" title="Gets the entities count.">GetEntitiesCount</a>() != 0;
<a name="l00130"></a>00130         }
<a name="l00131"></a>00131 
<a name="l00132"></a><a class="code" href="class_a_a_b_b_query_impl_a1f993228c5e5ab696c114bdcabd16c63.html#a1f993228c5e5ab696c114bdcabd16c63">00132</a>         <span class="keywordtype">bool</span> <a class="code" href="class_a_a_b_b_query_impl_a1f993228c5e5ab696c114bdcabd16c63.html#a1f993228c5e5ab696c114bdcabd16c63">ReportFixture</a>(b2Fixture* fixture)
<a name="l00133"></a>00133         {
<a name="l00134"></a>00134                 <a class="code" href="_definitions_8h_ab0e52c981a1bcd04e292959e2e8e1d84.html#ab0e52c981a1bcd04e292959e2e8e1d84">EntityPtr</a> entity = ((<a class="code" href="class_entity.html" title="Описывает любую сущность в игре.">Entity</a>*)(fixture-&gt;GetBody()-&gt;GetUserData()))-&gt;GetBehaviour()-&gt;GetActor();
<a name="l00135"></a>00135                 <a class="code" href="class_query_ad2e168be3faf7cf41da7f0b82b629869.html#ad2e168be3faf7cf41da7f0b82b629869" title="Pushes an entity.">PushEntity</a>(entity);
<a name="l00136"></a>00136                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00137"></a>00137         }
<a name="l00138"></a>00138 <span class="keyword">private</span>:
<a name="l00139"></a>00139         b2World* mWorld;
<a name="l00140"></a>00140         b2AABB mAABB;
<a name="l00141"></a>00141 };
<a name="l00142"></a>00142 
<a name="l00143"></a><a class="code" href="class_level_a39d2897caf921770078f0969a869825d.html#a39d2897caf921770078f0969a869825d">00143</a> std::string <a class="code" href="class_level_a39d2897caf921770078f0969a869825d.html#a39d2897caf921770078f0969a869825d" title="Gets the name.">Level::GetID</a>()
<a name="l00144"></a>00144 {
<a name="l00145"></a>00145         <span class="keywordflow">return</span> mName;
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a><a class="code" href="class_level_a92e2c689788b2364f2d1da750708b789.html#a92e2c689788b2364f2d1da750708b789">00148</a> <a class="code" href="class_level_a92e2c689788b2364f2d1da750708b789.html#a92e2c689788b2364f2d1da750708b789" title="Default constructor.">Level::Level</a>(std::string <span class="keywordtype">id</span>)
<a name="l00149"></a>00149 {
<a name="l00150"></a>00150         mName = id;
<a name="l00151"></a>00151         mPhisicsTimer = 1.0f / 30.0f;
<a name="l00152"></a>00152         mCamera.reset(<span class="keyword">new</span> <a class="code" href="class_camera.html">Camera</a>());
<a name="l00153"></a>00153         mWorld = <a class="code" href="class_box2_d_engine_a10a9f128d7b387a0b05d41228d360a5a.html#a10a9f128d7b387a0b05d41228d360a5a">Box2DEngine::GetSingleton</a>()-&gt;<a class="code" href="class_box2_d_engine_a4be4ec23874e091d005701312c83b0d6.html#a4be4ec23874e091d005701312c83b0d6">CreateWorld</a>();
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a><a class="code" href="class_level_a249eac1e8f19ff44134efa5e986feaca.html#a249eac1e8f19ff44134efa5e986feaca">00156</a> <a class="code" href="class_level_a249eac1e8f19ff44134efa5e986feaca.html#a249eac1e8f19ff44134efa5e986feaca" title="Destructor.">Level::~Level</a>()
<a name="l00157"></a>00157 {
<a name="l00158"></a>00158 }
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="class_level_a61c91e47f8b292c3d2d5e3b336f04304.html#a61c91e47f8b292c3d2d5e3b336f04304">00160</a> <a class="code" href="_definitions_8h_ab09cb343028db5d31f2127a1efc9efcf.html#ab09cb343028db5d31f2127a1efc9efcf">LayerPtr</a>        <a class="code" href="class_level_a61c91e47f8b292c3d2d5e3b336f04304.html#a61c91e47f8b292c3d2d5e3b336f04304" title="Gets a layer.">Level::GetLayer</a>(<span class="keywordtype">int</span> index)
<a name="l00161"></a>00161 {
<a name="l00162"></a>00162         <span class="keywordflow">return</span> mLayers.at(index);
<a name="l00163"></a>00163 }
<a name="l00164"></a>00164 
<a name="l00165"></a><a class="code" href="class_level_a6582f9c88d10bcf4bdf2d2c44380438f.html#a6582f9c88d10bcf4bdf2d2c44380438f">00165</a> <span class="keywordtype">int</span>     <a class="code" href="class_level_a6582f9c88d10bcf4bdf2d2c44380438f.html#a6582f9c88d10bcf4bdf2d2c44380438f" title="Gets the layers count.">Level::GetLayersCount</a>()
<a name="l00166"></a>00166 {
<a name="l00167"></a>00167         <span class="keywordflow">return</span> mLayers.size();
<a name="l00168"></a>00168 }
<a name="l00169"></a>00169 
<a name="l00170"></a><a class="code" href="class_level_ae25b959ce32a44a8bfda81c9d6951c52.html#ae25b959ce32a44a8bfda81c9d6951c52">00170</a> <span class="keywordtype">void</span>    <a class="code" href="class_level_a076de23a4976deabcd37b19ab945392e.html#a076de23a4976deabcd37b19ab945392e" title="Adds a layer.">Level::AddLayer</a>(<a class="code" href="_definitions_8h_ab09cb343028db5d31f2127a1efc9efcf.html#ab09cb343028db5d31f2127a1efc9efcf">LayerPtr</a> layer)
<a name="l00171"></a>00171 {
<a name="l00172"></a>00172         mLayers.push_back(layer);
<a name="l00173"></a>00173         mLayerNames[layer-&gt;GetName()] = layer;
<a name="l00174"></a>00174         layer-&gt;mLevel = shared_from_this();
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00177"></a><a class="code" href="class_level_a00c32484de146e39e9b619c9b986ac11.html#a00c32484de146e39e9b619c9b986ac11">00177</a> <span class="keywordtype">void</span>    <a class="code" href="class_level_a00c32484de146e39e9b619c9b986ac11.html#a00c32484de146e39e9b619c9b986ac11" title="Removes the layer described by layer.">Level::RemoveLayer</a>(<a class="code" href="_definitions_8h_ab09cb343028db5d31f2127a1efc9efcf.html#ab09cb343028db5d31f2127a1efc9efcf">LayerPtr</a> layer)
<a name="l00178"></a>00178 {
<a name="l00179"></a>00179         std::vector&lt;LayerPtr&gt;::iterator it = std::find(mLayers.begin(), mLayers.end(), layer);
<a name="l00180"></a>00180         <span class="keywordflow">if</span> (it != mLayers.end())
<a name="l00181"></a>00181         {
<a name="l00182"></a>00182                 mLayers.erase(it);
<a name="l00183"></a>00183                 mLayerNames.erase(layer-&gt;GetName());
<a name="l00184"></a>00184         }
<a name="l00185"></a>00185         <span class="keywordflow">else</span>
<a name="l00186"></a>00186         {
<a name="l00187"></a>00187                 <a class="code" href="_log_8h_a1e637ade475ed7e2a6211b82c367b7eb.html#a1e637ade475ed7e2a6211b82c367b7eb">LOG_W</a>(<span class="stringliteral">&quot;Trying to remove layer from level which doesn&#39;t contain it&quot;</span>);
<a name="l00188"></a>00188         }
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a><a class="code" href="class_level_a73b7e35c73fe45f482734b79eea10394.html#a73b7e35c73fe45f482734b79eea10394">00191</a> <a class="code" href="_definitions_8h_ab0e52c981a1bcd04e292959e2e8e1d84.html#ab0e52c981a1bcd04e292959e2e8e1d84">EntityPtr</a>       <a class="code" href="class_level_a73b7e35c73fe45f482734b79eea10394.html#a73b7e35c73fe45f482734b79eea10394" title="Creates an entity.">Level::CreateEntity</a>(std::string type, <span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> angle, std::string name)
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193         <span class="comment">// Создаем сущность</span>
<a name="l00194"></a>00194         <a class="code" href="_definitions_8h_ab0e52c981a1bcd04e292959e2e8e1d84.html#ab0e52c981a1bcd04e292959e2e8e1d84">EntityPtr</a> entity = <a class="code" href="class_factory_manager_a44d39e6d1d1b0b78ed1df424b4e94ac4.html#a44d39e6d1d1b0b78ed1df424b4e94ac4" title="Фозвращает единственный экзэмпляр фабрики">FactoryManager::GetSingleton</a>()-&gt;CreateEntity(type, name);
<a name="l00195"></a>00195 
<a name="l00196"></a>00196         <span class="comment">// Помещаем сущность на слой</span>
<a name="l00197"></a>00197         mLayers.back()-&gt;Add(entity);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         <span class="comment">// Устанавливаем координаты тела</span>
<a name="l00200"></a>00200         entity-&gt;SetPosition(x, y);
<a name="l00201"></a>00201         entity-&gt;SetAngle(angle);
<a name="l00202"></a>00202 
<a name="l00203"></a>00203         <span class="keywordflow">return</span> entity;
<a name="l00204"></a>00204 }
<a name="l00205"></a>00205 
<a name="l00206"></a><a class="code" href="class_level_a3e19d1db85faba0ecc141f0dfbdfaf8e.html#a3e19d1db85faba0ecc141f0dfbdfaf8e">00206</a> <span class="keywordtype">void</span>            <a class="code" href="class_level_a3e19d1db85faba0ecc141f0dfbdfaf8e.html#a3e19d1db85faba0ecc141f0dfbdfaf8e" title="Clears this object to its blank/initial state.">Level::Clear</a>()
<a name="l00207"></a>00207 {
<a name="l00208"></a>00208         mLayers.clear();
<a name="l00209"></a>00209         mLayerNames.clear();
<a name="l00210"></a>00210 }
<a name="l00211"></a>00211 
<a name="l00212"></a><a class="code" href="class_level_a036c0c90cb1dae5c08644e5e40e2a89a.html#a036c0c90cb1dae5c08644e5e40e2a89a">00212</a> <a class="code" href="_definitions_8h_ab09cb343028db5d31f2127a1efc9efcf.html#ab09cb343028db5d31f2127a1efc9efcf">LayerPtr</a>                <a class="code" href="class_level_a61c91e47f8b292c3d2d5e3b336f04304.html#a61c91e47f8b292c3d2d5e3b336f04304" title="Gets a layer.">Level::GetLayer</a>(std::string name)
<a name="l00213"></a>00213 {
<a name="l00214"></a>00214         LayerMap::iterator it = mLayerNames.find(name);
<a name="l00215"></a>00215         <span class="keywordflow">if</span> (it != mLayerNames.end())
<a name="l00216"></a>00216                 <span class="keywordflow">return</span> it-&gt;second;
<a name="l00217"></a>00217         <span class="keywordflow">else</span>
<a name="l00218"></a>00218         {
<a name="l00219"></a>00219                 <span class="keywordflow">return</span> <a class="code" href="class_level_a076de23a4976deabcd37b19ab945392e.html#a076de23a4976deabcd37b19ab945392e" title="Adds a layer.">AddLayer</a>(name);
<a name="l00220"></a>00220         }
<a name="l00221"></a>00221 }
<a name="l00222"></a>00222 
<a name="l00223"></a><a class="code" href="class_level_a7b9ace563bcf2f11612a0ed2ac72d38c.html#a7b9ace563bcf2f11612a0ed2ac72d38c">00223</a> b2World*        <a class="code" href="class_level_a7b9ace563bcf2f11612a0ed2ac72d38c.html#a7b9ace563bcf2f11612a0ed2ac72d38c" title="Gets the world.">Level::GetWorld</a>()
<a name="l00224"></a>00224 {
<a name="l00225"></a>00225         <span class="keywordflow">return</span> mWorld;
<a name="l00226"></a>00226 }
<a name="l00227"></a>00227 
<a name="l00228"></a><a class="code" href="class_level_ae93678525dba76bb09099906b88fa856.html#ae93678525dba76bb09099906b88fa856">00228</a> <span class="keywordtype">void</span>            <a class="code" href="class_level_ae93678525dba76bb09099906b88fa856.html#ae93678525dba76bb09099906b88fa856" title="Updates the given elapsedTime.">Level::Update</a>(<span class="keywordtype">float</span> elapsedTime)
<a name="l00229"></a>00229 {
<a name="l00230"></a>00230         <a class="code" href="_definitions_8h_a4309fc5220c729a08d1b0ff3dc399e7d.html#a4309fc5220c729a08d1b0ff3dc399e7d">EntitySet</a> destroyed;
<a name="l00231"></a>00231 
<a name="l00232"></a>00232         EntitySet::iterator it = mEntities.begin();
<a name="l00233"></a>00233         <span class="keywordflow">while</span> (it != mEntities.end())
<a name="l00234"></a>00234         {
<a name="l00235"></a>00235                 <a class="code" href="_definitions_8h_ab0e52c981a1bcd04e292959e2e8e1d84.html#ab0e52c981a1bcd04e292959e2e8e1d84">EntityPtr</a> entity = *it;
<a name="l00236"></a>00236                 entity-&gt;Update(elapsedTime);
<a name="l00237"></a>00237 
<a name="l00238"></a>00238                 <span class="keywordflow">if</span> (entity-&gt;IsRemoved())
<a name="l00239"></a>00239                 {
<a name="l00240"></a>00240                         entity-&gt;GetLayer()-&gt;Remove(entity);
<a name="l00241"></a>00241                         destroyed.insert(entity);
<a name="l00242"></a>00242                         ++it;
<a name="l00243"></a>00243                 }
<a name="l00244"></a>00244                 <span class="keywordflow">else</span>
<a name="l00245"></a>00245                 {
<a name="l00246"></a>00246                         ++it;
<a name="l00247"></a>00247                 }
<a name="l00248"></a>00248         }
<a name="l00249"></a>00249 
<a name="l00250"></a>00250         <span class="keywordflow">for</span> (EntitySet::iterator it = destroyed.begin(); it != destroyed.end(); ++it)
<a name="l00251"></a>00251         {
<a name="l00252"></a>00252 <span class="comment">//              FactoryManager::GetSingleton()-&gt;DestroyEntity(*it);</span>
<a name="l00253"></a>00253                 mEntities.erase(*it);
<a name="l00254"></a>00254         }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         
<a name="l00257"></a>00257         mPhisicsTimer = elapsedTime;
<a name="l00258"></a>00258 
<a name="l00259"></a>00259         <span class="keywordflow">if</span> (<a class="code" href="class_game_a7be45807a3329d368134f6310ac5300c.html#a7be45807a3329d368134f6310ac5300c">Game::GetSingleton</a>()-&gt;GetUsePhisics())
<a name="l00260"></a>00260         {
<a name="l00261"></a>00261                 mWorld-&gt;Step(elapsedTime, 6, 2);
<a name="l00262"></a>00262                 mWorld-&gt;ClearForces();
<a name="l00263"></a>00263         }
<a name="l00264"></a>00264         
<a name="l00265"></a>00265 
<a name="l00266"></a>00266         mCamera-&gt;Update(elapsedTime);
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a><a class="code" href="class_level_a076de23a4976deabcd37b19ab945392e.html#a076de23a4976deabcd37b19ab945392e">00269</a> <a class="code" href="_definitions_8h_ab09cb343028db5d31f2127a1efc9efcf.html#ab09cb343028db5d31f2127a1efc9efcf">LayerPtr</a>        <a class="code" href="class_level_a076de23a4976deabcd37b19ab945392e.html#a076de23a4976deabcd37b19ab945392e" title="Adds a layer.">Level::AddLayer</a>(std::string name)
<a name="l00270"></a>00270 {
<a name="l00271"></a>00271         <span class="keywordflow">if</span> (mLayerNames.find(name) == mLayerNames.end())
<a name="l00272"></a>00272         {
<a name="l00273"></a>00273                 <a class="code" href="_definitions_8h_ab09cb343028db5d31f2127a1efc9efcf.html#ab09cb343028db5d31f2127a1efc9efcf">LayerPtr</a> layer(<span class="keyword">new</span> <a class="code" href="class_level_a834e4e869446be644f61b4b456604f31.html#a834e4e869446be644f61b4b456604f31" title="The layer.">Layer</a>());
<a name="l00274"></a>00274                 mLayers.push_back(layer);
<a name="l00275"></a>00275                 layer-&gt;mLevel = shared_from_this();
<a name="l00276"></a>00276                 layer-&gt;mName = name;
<a name="l00277"></a>00277                 mLayerNames[name] = layer;
<a name="l00278"></a>00278 
<a name="l00279"></a>00279                 <span class="keywordflow">return</span> layer;
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281         <span class="keywordflow">else</span>
<a name="l00282"></a>00282         {
<a name="l00283"></a>00283                 <span class="keywordflow">return</span>  mLayerNames[name];
<a name="l00284"></a>00284         }
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a><a class="code" href="class_level_a6e8f275c54e006fd710cbd51a587d1c8.html#a6e8f275c54e006fd710cbd51a587d1c8">00287</a> <a class="code" href="_definitions_8h_a2b604caf0916f44e0707c3d54533bd7b.html#a2b604caf0916f44e0707c3d54533bd7b">QueryPtr</a>        <a class="code" href="class_level_a6e8f275c54e006fd710cbd51a587d1c8.html#a6e8f275c54e006fd710cbd51a587d1c8" title="Ray cast query all.">Level::RayCastQueryAll</a>(<span class="keywordtype">float</span> x1, <span class="keywordtype">float</span> y1, <span class="keywordtype">float</span> x2, <span class="keywordtype">float</span> y2, <span class="keywordtype">int</span> count)
<a name="l00288"></a>00288 {
<a name="l00289"></a>00289         <a class="code" href="_definitions_8h_a2b604caf0916f44e0707c3d54533bd7b.html#a2b604caf0916f44e0707c3d54533bd7b">QueryPtr</a> result(<span class="keyword">new</span> <a class="code" href="class_ray_query_impl.html">RayQueryImpl</a>(<a class="code" href="class_level_a7b9ace563bcf2f11612a0ed2ac72d38c.html#a7b9ace563bcf2f11612a0ed2ac72d38c" title="Gets the world.">GetWorld</a>(), x1, y1, x2, y2, <a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834efa7afde2c2862a62620c77c16cc076cdd3">RayCast::All</a>));
<a name="l00290"></a>00290         result-&gt;Execute();
<a name="l00291"></a>00291         <span class="keywordflow">return</span> result;
<a name="l00292"></a>00292 }
<a name="l00293"></a>00293 
<a name="l00294"></a><a class="code" href="class_level_ad96af9cc266b8b5eb85b75fa3949d195.html#ad96af9cc266b8b5eb85b75fa3949d195">00294</a> <a class="code" href="_definitions_8h_ab0e52c981a1bcd04e292959e2e8e1d84.html#ab0e52c981a1bcd04e292959e2e8e1d84">EntityPtr</a>       <a class="code" href="class_level_ad96af9cc266b8b5eb85b75fa3949d195.html#ad96af9cc266b8b5eb85b75fa3949d195" title="Ray cast query nearest.">Level::RayCastQueryNearest</a>(<span class="keywordtype">float</span> x1, <span class="keywordtype">float</span> y1, <span class="keywordtype">float</span> x2, <span class="keywordtype">float</span> y2)
<a name="l00295"></a>00295 {
<a name="l00296"></a>00296         <a class="code" href="class_ray_query_impl.html">RayQueryImpl</a> query(<a class="code" href="class_level_a7b9ace563bcf2f11612a0ed2ac72d38c.html#a7b9ace563bcf2f11612a0ed2ac72d38c" title="Gets the world.">GetWorld</a>(), x1, y1, x2, y2,  <a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834efa37b888e946f0973666da6de865653e73">RayCast::Nearest</a>);
<a name="l00297"></a>00297         query.<a class="code" href="class_ray_query_impl_a4eb97c62221bdbda005c7fd606d7d9b8.html#a4eb97c62221bdbda005c7fd606d7d9b8" title="Executes this object.">Execute</a>();
<a name="l00298"></a>00298         <span class="keywordflow">return</span> query.<a class="code" href="class_query_ab14c1c33fa3d92abc0f8d13dd5e785b0.html#ab14c1c33fa3d92abc0f8d13dd5e785b0" title="Gets an entity.">GetEntity</a>(0);
<a name="l00299"></a>00299 }
<a name="l00300"></a>00300 
<a name="l00301"></a><a class="code" href="class_level_a907dcd47ddcb532db9489eaf8179dcac.html#a907dcd47ddcb532db9489eaf8179dcac">00301</a> <span class="keywordtype">bool</span>    <a class="code" href="class_level_a907dcd47ddcb532db9489eaf8179dcac.html#a907dcd47ddcb532db9489eaf8179dcac" title="Ray cast query any.">Level::RayCastQueryAny</a>(<span class="keywordtype">float</span> x1, <span class="keywordtype">float</span> y1, <span class="keywordtype">float</span> x2, <span class="keywordtype">float</span> y2)
<a name="l00302"></a>00302 {
<a name="l00303"></a>00303         <a class="code" href="class_ray_query_impl.html">RayQueryImpl</a> query(<a class="code" href="class_level_a7b9ace563bcf2f11612a0ed2ac72d38c.html#a7b9ace563bcf2f11612a0ed2ac72d38c" title="Gets the world.">GetWorld</a>(), x1, y1, x2, y2,  <a class="code" href="namespace_ray_cast_a1ccafb093c87957bce148171510834ef.html#a1ccafb093c87957bce148171510834efa1b2e412c6d36b6680eb09ca59563bc57">RayCast::Any</a>);
<a name="l00304"></a>00304         <span class="keywordflow">return</span> query.<a class="code" href="class_ray_query_impl_a4eb97c62221bdbda005c7fd606d7d9b8.html#a4eb97c62221bdbda005c7fd606d7d9b8" title="Executes this object.">Execute</a>();
<a name="l00305"></a>00305 }
<a name="l00306"></a>00306 
<a name="l00307"></a><a class="code" href="class_level_aa60721e62ff8853a8343d54034a4838c.html#aa60721e62ff8853a8343d54034a4838c">00307</a> <a class="code" href="_definitions_8h_a2b604caf0916f44e0707c3d54533bd7b.html#a2b604caf0916f44e0707c3d54533bd7b">QueryPtr</a> <a class="code" href="class_level_aa60721e62ff8853a8343d54034a4838c.html#aa60721e62ff8853a8343d54034a4838c" title="Aabb query.">Level::AABBQuery</a>(<span class="keywordtype">float</span> x1, <span class="keywordtype">float</span> y1, <span class="keywordtype">float</span> x2, <span class="keywordtype">float</span> y2)
<a name="l00308"></a>00308 {
<a name="l00309"></a>00309         <a class="code" href="_definitions_8h_a2b604caf0916f44e0707c3d54533bd7b.html#a2b604caf0916f44e0707c3d54533bd7b">QueryPtr</a> result(<span class="keyword">new</span> <a class="code" href="class_a_a_b_b_query_impl.html">AABBQueryImpl</a>(<a class="code" href="class_level_a7b9ace563bcf2f11612a0ed2ac72d38c.html#a7b9ace563bcf2f11612a0ed2ac72d38c" title="Gets the world.">GetWorld</a>(), x1, y1, x2, y2));
<a name="l00310"></a>00310         result-&gt;Execute();
<a name="l00311"></a>00311         <span class="keywordflow">return</span> result;
<a name="l00312"></a>00312 }
<a name="l00313"></a>00313 
<a name="l00314"></a><a class="code" href="_level_8cpp_aea70a710da9e4e15f2033756c237516c.html#aea70a710da9e4e15f2033756c237516c">00314</a> <span class="keywordtype">void</span>    <a class="code" href="_level_8cpp_aea70a710da9e4e15f2033756c237516c.html#aea70a710da9e4e15f2033756c237516c">ParseWorld</a>(<a class="code" href="_definitions_8h_aaebfa4e73ceefef35bc254bd4b27030d.html#aaebfa4e73ceefef35bc254bd4b27030d">LevelPtr</a> level, TiXmlElement* rootElement)
<a name="l00315"></a>00315 {
<a name="l00316"></a>00316         TiXmlElement*   worldElement = rootElement-&gt;FirstChildElement(<span class="stringliteral">&quot;World&quot;</span>);
<a name="l00317"></a>00317 
<a name="l00318"></a>00318         <span class="keywordflow">if</span> (!worldElement)
<a name="l00319"></a>00319                 <span class="keywordflow">return</span>;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321         <a class="code" href="_definitions_8h_ac41ea418abac18d703df1b41c255ee26.html#ac41ea418abac18d703df1b41c255ee26" title="Определения, относящиеся к Box2D.">Vector2</a> gravity(0.0f, 9.8f);
<a name="l00322"></a>00322 
<a name="l00323"></a>00323         <span class="keyword">const</span> <span class="keywordtype">char</span>* str = worldElement-&gt;Attribute(<span class="stringliteral">&quot;Gravity&quot;</span>);
<a name="l00324"></a>00324         <span class="keywordflow">if</span> (str)
<a name="l00325"></a>00325         {
<a name="l00326"></a>00326                 sscanf_s(str, <span class="stringliteral">&quot;%f, %f&quot;</span>, &amp;gravity.x, &amp;gravity.y);
<a name="l00327"></a>00327         }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329         level-&gt;GetWorld()-&gt;SetGravity(gravity);
<a name="l00330"></a>00330 }
<a name="l00331"></a>00331 
<a name="l00332"></a><a class="code" href="_level_8cpp_a107790481ac02fcc0fc1e3e323a2efb2.html#a107790481ac02fcc0fc1e3e323a2efb2">00332</a> <span class="keywordtype">void</span>    <a class="code" href="_level_8cpp_a107790481ac02fcc0fc1e3e323a2efb2.html#a107790481ac02fcc0fc1e3e323a2efb2">ParseEntity</a>(<a class="code" href="_definitions_8h_ab09cb343028db5d31f2127a1efc9efcf.html#ab09cb343028db5d31f2127a1efc9efcf">LayerPtr</a> layer, TiXmlElement* entityElement)
<a name="l00333"></a>00333 {
<a name="l00334"></a>00334         <span class="comment">// Читаем тип сущности и ее имя</span>
<a name="l00335"></a>00335         <span class="keyword">const</span> <span class="keywordtype">char</span>* typeAttr = entityElement-&gt;Attribute(<span class="stringliteral">&quot;Type&quot;</span>);
<a name="l00336"></a>00336         <span class="keyword">const</span> <span class="keywordtype">char</span>* nameAttr = entityElement-&gt;Attribute(<span class="stringliteral">&quot;Name&quot;</span>);
<a name="l00337"></a>00337 
<a name="l00338"></a>00338         <span class="comment">// Если не указан тип сущности, пропускаем эелемент</span>
<a name="l00339"></a>00339         <span class="keywordflow">if</span> (!typeAttr)
<a name="l00340"></a>00340         {
<a name="l00341"></a>00341                 <a class="code" href="_log_8h_a555d86ddc4dea5a36c4d4185ed54e010.html#a555d86ddc4dea5a36c4d4185ed54e010">LOG_E</a>(<span class="stringliteral">&quot;Entity XML element doesn&#39;t contain entity type&quot;</span>);
<a name="l00342"></a>00342                 <span class="keywordflow">return</span>;
<a name="l00343"></a>00343         }
<a name="l00344"></a>00344 
<a name="l00345"></a>00345         <span class="comment">// Создаем сущность</span>
<a name="l00346"></a>00346         <a class="code" href="_definitions_8h_ab0e52c981a1bcd04e292959e2e8e1d84.html#ab0e52c981a1bcd04e292959e2e8e1d84">EntityPtr</a> entity = <a class="code" href="class_factory_manager_a44d39e6d1d1b0b78ed1df424b4e94ac4.html#a44d39e6d1d1b0b78ed1df424b4e94ac4" title="Фозвращает единственный экзэмпляр фабрики">FactoryManager::GetSingleton</a>()-&gt;CreateEntity(typeAttr, nameAttr ? nameAttr : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00347"></a>00347 
<a name="l00348"></a>00348         <span class="comment">// Помещаем сущность на слой</span>
<a name="l00349"></a>00349         layer-&gt;Add(entity);
<a name="l00350"></a>00350 
<a name="l00351"></a>00351         <span class="comment">//Читаем координаты сущности</span>
<a name="l00352"></a>00352         <span class="keyword">const</span> <span class="keywordtype">char</span>* positionAttr = entityElement-&gt;Attribute(<span class="stringliteral">&quot;Position&quot;</span>);
<a name="l00353"></a>00353         <span class="keywordtype">float</span> x = 0.0f;
<a name="l00354"></a>00354         <span class="keywordtype">float</span> y = 0.0f;
<a name="l00355"></a>00355         <span class="keywordtype">float</span> angle = 0.0f;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357         <span class="keywordflow">if</span> (positionAttr)
<a name="l00358"></a>00358         {
<a name="l00359"></a>00359                 sscanf(positionAttr, <span class="stringliteral">&quot;%f, %f, %f&quot;</span>, &amp;x, &amp;y, &amp;angle);
<a name="l00360"></a>00360         }
<a name="l00361"></a>00361         
<a name="l00362"></a>00362         entity-&gt;SetPosition(x, y);
<a name="l00363"></a>00363         entity-&gt;SetAngle(angle);
<a name="l00364"></a>00364 
<a name="l00365"></a>00365         <span class="comment">// Читаем уточнение поведения</span>
<a name="l00366"></a>00366         TiXmlElement* behaviourElement = entityElement-&gt;FirstChildElement(<span class="stringliteral">&quot;Behaviour&quot;</span>);
<a name="l00367"></a>00367         <span class="keywordflow">if</span> (behaviourElement)
<a name="l00368"></a>00368         {
<a name="l00369"></a>00369                 entity-&gt;GetBehaviour()-&gt;Customize(behaviourElement);
<a name="l00370"></a>00370         }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372         <span class="comment">// Масштабируем объект</span>
<a name="l00373"></a>00373         <span class="keywordtype">float</span> scale = 1.0f;
<a name="l00374"></a>00374         entityElement-&gt;QueryFloatAttribute(<span class="stringliteral">&quot;Scale&quot;</span>, &amp;scale);
<a name="l00375"></a>00375         <span class="keywordflow">if</span> (scale &gt; 0.0f)
<a name="l00376"></a>00376         {
<a name="l00377"></a>00377                 entity-&gt;SetScale(scale);
<a name="l00378"></a>00378         }
<a name="l00379"></a>00379 }
<a name="l00380"></a>00380 
<a name="l00381"></a><a class="code" href="_level_8cpp_a646a31e86bbc1495478ffb1cd76b0c31.html#a646a31e86bbc1495478ffb1cd76b0c31">00381</a> <span class="keywordtype">void</span> <a class="code" href="_level_8cpp_a646a31e86bbc1495478ffb1cd76b0c31.html#a646a31e86bbc1495478ffb1cd76b0c31">ParseLayers</a>(<a class="code" href="_definitions_8h_aaebfa4e73ceefef35bc254bd4b27030d.html#aaebfa4e73ceefef35bc254bd4b27030d">LevelPtr</a> level, TiXmlElement* rootElement)
<a name="l00382"></a>00382 {
<a name="l00383"></a>00383         TiXmlElement* layerElement = rootElement-&gt;FirstChildElement(<span class="stringliteral">&quot;Layer&quot;</span>);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385         <span class="keywordflow">while</span> (layerElement)
<a name="l00386"></a>00386         {
<a name="l00387"></a>00387                 std::string name = layerElement-&gt;Attribute(<span class="stringliteral">&quot;Name&quot;</span>);
<a name="l00388"></a>00388                 <a class="code" href="_definitions_8h_ab09cb343028db5d31f2127a1efc9efcf.html#ab09cb343028db5d31f2127a1efc9efcf">LayerPtr</a> layer = level-&gt;AddLayer(name);
<a name="l00389"></a>00389 
<a name="l00390"></a>00390                 TiXmlElement* element = layerElement-&gt;FirstChildElement();
<a name="l00391"></a>00391                 <span class="keywordflow">while</span> (element)
<a name="l00392"></a>00392                 {
<a name="l00393"></a>00393                         std::string category = element-&gt;Value();
<a name="l00394"></a>00394 
<a name="l00395"></a>00395                         <span class="keywordflow">if</span> (category == <span class="stringliteral">&quot;Entity&quot;</span>)
<a name="l00396"></a>00396                         {
<a name="l00397"></a>00397                                 <a class="code" href="_level_8cpp_a107790481ac02fcc0fc1e3e323a2efb2.html#a107790481ac02fcc0fc1e3e323a2efb2">ParseEntity</a>(layer, element);
<a name="l00398"></a>00398                         }
<a name="l00399"></a>00399                         <span class="keywordflow">else</span>
<a name="l00400"></a>00400                         {
<a name="l00401"></a>00401                                 <a class="code" href="_log_8h_a1e637ade475ed7e2a6211b82c367b7eb.html#a1e637ade475ed7e2a6211b82c367b7eb">LOG_W</a>(<span class="stringliteral">&quot;Layer XML element contains ivalid child element&quot;</span>);
<a name="l00402"></a>00402                         }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404                         element = element-&gt;NextSiblingElement();
<a name="l00405"></a>00405                 }
<a name="l00406"></a>00406                 layerElement = layerElement-&gt;NextSiblingElement(<span class="stringliteral">&quot;Layer&quot;</span>);
<a name="l00407"></a>00407         }
<a name="l00408"></a>00408 }
<a name="l00409"></a>00409 
<a name="l00410"></a><a class="code" href="_level_8cpp_a2bed0c2a4cab1da9bc6c4e651e50c0f8.html#a2bed0c2a4cab1da9bc6c4e651e50c0f8">00410</a> <span class="keywordtype">void</span> <a class="code" href="_level_8cpp_a2bed0c2a4cab1da9bc6c4e651e50c0f8.html#a2bed0c2a4cab1da9bc6c4e651e50c0f8">ParseScripts</a>(<a class="code" href="_definitions_8h_aaebfa4e73ceefef35bc254bd4b27030d.html#aaebfa4e73ceefef35bc254bd4b27030d">LevelPtr</a> level, TiXmlElement* rootElement)
<a name="l00411"></a>00411 {
<a name="l00412"></a>00412         TiXmlElement* scriptsElement = rootElement-&gt;FirstChildElement(<span class="stringliteral">&quot;Scripts&quot;</span>);
<a name="l00413"></a>00413         <span class="keywordflow">if</span> (scriptsElement == 0)
<a name="l00414"></a>00414                 <span class="keywordflow">return</span>;
<a name="l00415"></a>00415 
<a name="l00416"></a>00416         <span class="comment">// Читаем и выполняем Lua-сценарии</span>
<a name="l00417"></a>00417         lua_State* state = <a class="code" href="class_engine_aae2471c8903d2a70305ea470a6329595.html#aae2471c8903d2a70305ea470a6329595" title="Возвращает единственный экзэмпляр движка">Engine::GetSingleton</a>()-&gt;<a class="code" href="class_engine_a9eda8630193c8d22fbaee39ed22e6eb3.html#a9eda8630193c8d22fbaee39ed22e6eb3" title="Возвращает состояние Lua.">GetLua</a>();
<a name="l00418"></a>00418 
<a name="l00419"></a>00419         TiXmlElement* luaElement = scriptsElement-&gt;FirstChildElement(<span class="stringliteral">&quot;Lua&quot;</span>);
<a name="l00420"></a>00420         <span class="keywordflow">while</span> (luaElement)
<a name="l00421"></a>00421         {
<a name="l00422"></a>00422                 luaL_dofile(state, luaElement-&gt;GetText());
<a name="l00423"></a>00423                 luaElement = luaElement-&gt;NextSiblingElement(<span class="stringliteral">&quot;Lua&quot;</span>);
<a name="l00424"></a>00424         }
<a name="l00425"></a>00425 
<a name="l00426"></a>00426         <span class="keywordflow">if</span> (scriptsElement-&gt;Attribute(<span class="stringliteral">&quot;StartScript&quot;</span>))
<a name="l00427"></a>00427         {
<a name="l00428"></a>00428                 <span class="keyword">const</span> <span class="keywordtype">char</span>* sc = scriptsElement-&gt;Attribute(<span class="stringliteral">&quot;StartScript&quot;</span>);
<a name="l00429"></a>00429                 luaL_dostring(state, sc);
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 }
<a name="l00433"></a>00433 
<a name="l00434"></a><a class="code" href="_level_8cpp_ac4a682a8078c33ae87a8cec15ad1f1ca.html#ac4a682a8078c33ae87a8cec15ad1f1ca">00434</a> <span class="keywordtype">void</span> <a class="code" href="_level_8cpp_ac4a682a8078c33ae87a8cec15ad1f1ca.html#ac4a682a8078c33ae87a8cec15ad1f1ca">ParseJoints</a>(<a class="code" href="_definitions_8h_aaebfa4e73ceefef35bc254bd4b27030d.html#aaebfa4e73ceefef35bc254bd4b27030d">LevelPtr</a> level, TiXmlElement* rootElement)
<a name="l00435"></a>00435 {
<a name="l00436"></a>00436         <a class="code" href="_definitions_8h_af2d0d11fa78c521b376d215a108f5211.html#af2d0d11fa78c521b376d215a108f5211">FactoryPtr</a> factory = <a class="code" href="class_factory_manager_a44d39e6d1d1b0b78ed1df424b4e94ac4.html#a44d39e6d1d1b0b78ed1df424b4e94ac4" title="Фозвращает единственный экзэмпляр фабрики">FactoryManager::GetSingleton</a>();
<a name="l00437"></a>00437 
<a name="l00438"></a>00438         TiXmlElement* jointElement = rootElement-&gt;FirstChildElement(<span class="stringliteral">&quot;Joint&quot;</span>);
<a name="l00439"></a>00439 
<a name="l00440"></a>00440         <span class="keywordflow">while</span>( jointElement)
<a name="l00441"></a>00441         {
<a name="l00442"></a>00442                 <a class="code" href="_joints_8h_aceb8fac16a1b26b1feb1d59fb56fe229.html#aceb8fac16a1b26b1feb1d59fb56fe229">JointDefPtr</a> def(<span class="keyword">new</span> <a class="code" href="class_joint_definition.html">JointDefinition</a>());
<a name="l00443"></a>00443                 def-&gt;Parse(jointElement);
<a name="l00444"></a>00444                 def-&gt;world = level-&gt;GetWorld();
<a name="l00445"></a>00445 
<a name="l00446"></a>00446                 factory-&gt;CreateJoint(def);
<a name="l00447"></a>00447 
<a name="l00448"></a>00448                 jointElement = jointElement-&gt;NextSiblingElement(<span class="stringliteral">&quot;Joint&quot;</span>);
<a name="l00449"></a>00449         }
<a name="l00450"></a>00450 }
<a name="l00451"></a>00451 
<a name="l00452"></a><a class="code" href="class_level_ac5c0a5f322095b8c02336e23dd838fc1.html#ac5c0a5f322095b8c02336e23dd838fc1">00452</a> <a class="code" href="_definitions_8h_aaebfa4e73ceefef35bc254bd4b27030d.html#aaebfa4e73ceefef35bc254bd4b27030d">LevelPtr</a>        <a class="code" href="class_level_ac5c0a5f322095b8c02336e23dd838fc1.html#ac5c0a5f322095b8c02336e23dd838fc1" title="Loads.">Level::Load</a>(TiXmlElement* levelElement)
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454         <a class="code" href="_definitions_8h_aaebfa4e73ceefef35bc254bd4b27030d.html#aaebfa4e73ceefef35bc254bd4b27030d">LevelPtr</a> level(<span class="keyword">new</span> <a class="code" href="class_level_a92e2c689788b2364f2d1da750708b789.html#a92e2c689788b2364f2d1da750708b789" title="Default constructor.">Level</a>());
<a name="l00455"></a>00455 
<a name="l00456"></a>00456         <span class="comment">// Имя уровня</span>
<a name="l00457"></a>00457         <span class="keyword">const</span> <span class="keywordtype">char</span>* nameAttr = levelElement-&gt;Attribute(<span class="stringliteral">&quot;Name&quot;</span>);
<a name="l00458"></a>00458         <span class="keywordflow">if</span> (nameAttr)
<a name="l00459"></a>00459                 level-&gt;mName = nameAttr;
<a name="l00460"></a>00460 
<a name="l00461"></a>00461         <a class="code" href="_level_8cpp_aea70a710da9e4e15f2033756c237516c.html#aea70a710da9e4e15f2033756c237516c">ParseWorld</a>(level, levelElement);
<a name="l00462"></a>00462         <a class="code" href="_level_8cpp_a646a31e86bbc1495478ffb1cd76b0c31.html#a646a31e86bbc1495478ffb1cd76b0c31">ParseLayers</a>(level, levelElement);
<a name="l00463"></a>00463         <a class="code" href="_level_8cpp_a2bed0c2a4cab1da9bc6c4e651e50c0f8.html#a2bed0c2a4cab1da9bc6c4e651e50c0f8">ParseScripts</a>(level, levelElement);
<a name="l00464"></a>00464         <a class="code" href="_level_8cpp_ac4a682a8078c33ae87a8cec15ad1f1ca.html#ac4a682a8078c33ae87a8cec15ad1f1ca">ParseJoints</a>(level, levelElement);
<a name="l00465"></a>00465 
<a name="l00466"></a>00466         <span class="keywordflow">return</span> level;
<a name="l00467"></a>00467 }
<a name="l00468"></a>00468 
<a name="l00469"></a><a class="code" href="class_level_a3b927084595ca02d1f5bb24ad72a1bc4.html#a3b927084595ca02d1f5bb24ad72a1bc4">00469</a> <a class="code" href="_definitions_8h_aaebfa4e73ceefef35bc254bd4b27030d.html#aaebfa4e73ceefef35bc254bd4b27030d">LevelPtr</a>        <a class="code" href="class_level_ac5c0a5f322095b8c02336e23dd838fc1.html#ac5c0a5f322095b8c02336e23dd838fc1" title="Loads.">Level::Load</a>(std::string fileName)
<a name="l00470"></a>00470 {
<a name="l00471"></a>00471         TiXmlDocument* document = <span class="keyword">new</span> TiXmlDocument();
<a name="l00472"></a>00472         document-&gt;LoadFile(fileName.data());
<a name="l00473"></a>00473 
<a name="l00474"></a>00474         TiXmlElement* root = document-&gt;RootElement();
<a name="l00475"></a>00475 
<a name="l00476"></a>00476         <a class="code" href="_definitions_8h_aaebfa4e73ceefef35bc254bd4b27030d.html#aaebfa4e73ceefef35bc254bd4b27030d">LevelPtr</a> level = <a class="code" href="class_level_ac5c0a5f322095b8c02336e23dd838fc1.html#ac5c0a5f322095b8c02336e23dd838fc1" title="Loads.">Level::Load</a>(root);
<a name="l00477"></a>00477 
<a name="l00478"></a>00478         <span class="keyword">delete</span> document;
<a name="l00479"></a>00479 
<a name="l00480"></a>00480         <span class="keywordflow">return</span> level;
<a name="l00481"></a>00481 }
<a name="l00482"></a>00482 
<a name="l00483"></a><a class="code" href="class_level_a443d27cb3522db78aa8cb091486660d8.html#a443d27cb3522db78aa8cb091486660d8">00483</a> <span class="keywordtype">void</span> <a class="code" href="class_level_a443d27cb3522db78aa8cb091486660d8.html#a443d27cb3522db78aa8cb091486660d8">Level::RenameLayer</a>( std::string oldName, std::string name )
<a name="l00484"></a>00484 {
<a name="l00485"></a>00485         LayerMap::iterator it = mLayerNames.find(oldName);
<a name="l00486"></a>00486         <span class="keywordflow">if</span> (it == mLayerNames.end())
<a name="l00487"></a>00487                 <span class="keywordflow">return</span>;
<a name="l00488"></a>00488         <a class="code" href="_definitions_8h_ab09cb343028db5d31f2127a1efc9efcf.html#ab09cb343028db5d31f2127a1efc9efcf">LayerPtr</a> layer = it-&gt;second;
<a name="l00489"></a>00489         layer-&gt;mName = name;
<a name="l00490"></a>00490 
<a name="l00491"></a>00491         mLayerNames.erase(it);
<a name="l00492"></a>00492         mLayerNames[name] = layer;
<a name="l00493"></a>00493 }
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 18 2012 22:12:44 for Isilme SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
